<!DOCTYPE html>
{% load to_replace %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
<style>
    .form-rounded {
        border-radius: 0.7rem;
    }
    .label-text {
        font-size: 0.8em;
    }
    .offer-text {
        font-size: 0.7em;
    }

    #win_respond {
            background-color: #E6F1DA;
    }
    .responds-block {
            border-radius: 20px;
    }
    .responds-img {
            width: 10em;
            height: 14em;
    }
</style>

    <div class="container mt-3">
        <h5>Отклик к заданию {{ order.set_numb_of_order }}</h5>
        <hr>
        <!--Экранирование html-->
        {% autoescape off %}
        <p>{{ order.note|to_replace }}</p>
        {% endautoescape %}

        <p><small class="text-muted">Количество откликов:</small> {{ amount_responds }} из {{ order.max_responds }}<br>
        <small class="text-muted">Стоимость отклика:</small> {{ order.respond_price }} руб.<br>
        <small class="text-muted">Мой баланс:</small> {{ staff.balance }} руб. <a href="#"><small>(пополнить)</small></a></p>
        <hr>

        <!-- Проверка что у него нет отклика  -->

        {% if amount_responds < order.max_responds and respond == None %}

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label class="text-muted label-text" for="message">Текст отклика:</label>
                <textarea class="form-control form-control-sm form-rounded" id="message" name="message" rows="3"></textarea>
            </div>
            <div class="form-group my-2">
                <div class="row">
                    <div class="col-6">
                        <label class="text-muted label-text" for="instagram">Мой Instagram:</label>
                        <input type="text" class="form-control form-control-sm" id="instagram" name="instagram" value="@{{ staff.instagram }}" disabled>
                    </div>
                    <div class="col-6">
                        <label class="text-muted label-text" for="whatsapp">Мой Whatsapp:</label>
                        <input type="text" class="form-control form-control-sm" id="whatsapp" name="whatsapp" value="+{{ staff.phone }}" disabled>
                    </div>
                </div>
            </div>
            <div class="form-group my-2">
                <label class="text-muted label-text" for="images">Фото работ</label>
                <input type="file" class="form-control form-control-sm" id="images" name="images" multiple>
            </div>
            <div class="form-group my-2">
                <div class="row">
                    <div class="col-6">
                        <label class="text-muted label-text" for="price">Цена:</label>
                        <input type="text" class="form-control form-control-sm" id="price" name="price">
                    </div>
                    <div class="col-6">
                         <label class="text-muted label-text" for="pin">pin</label>
                         <input type="text" class="form-control form-control-sm" id="pin" name="pin">
                    </div>
                </div>
            </div>
            {% if has_balance %}
            <div class="d-grid gap-2 mt-2">
                <small class="offer-text text-muted">Нажимая кнопку "Откликнуться" с баланса будут списаны {{ order.respond_price }} руб. и отклик с вашими контактными данными будет отправлен заказчику. Закачик свяжется с вами, если ваш отклик его заинтересует.</small>
                <input class="btn btn-success btn-md form-rounded" type="submit" value="Откликнуться">
            </div>
            {% else %}
            <div class="d-grid gap-2 mt-2">
                <small class="offer-text text-muted">Для того, чтобы отправить свой отклик клиенту с вашими контактными данными требуется пополнить баланс. Для отклика требуется {{ order.respond_price }} руб., а ваш баланс равен {{ staff.balance }} руб..</small>
                <button class="btn btn-danger btn-md form-rounded" disabled>Пополните баланс</button>
            </div>
            {% endif %}
        </form>

        {% elif respond %}
        <p>Вы уже оставили отклик</p>
        <div id="win_respond" class="border border-1 responds-block mb-3">

            <div class="container p-3">
                <h5><a class="text-dark" href="{% url 'staff_list' %}#{{ respond.staff.id }}">{{ respond.staff.name }} {{ respond.staff.surname }}</a></h5>
                <small class="text-muted">Telegram: <a href="https://t.me/{{ respond.staff.username }}">@{{ respond.staff.username }}</a></small><br>
                <small class="text-muted">Номер: {{ respond.staff.phone }}</small><br>
                <small class="text-muted"><a href="https://wa.me/{{ respond.staff.phone }}">Написать в Whatsapp</a></small><br>
                <b>Ответ:</b> {{ respond.text }}<br>
                <b>Цена:</b> {{ respond.price }}

                <div class="container mt-3">
                    <div class="row">
                        {% for image in respond.images.all %}
                        <div class="col-lg-3 col-md-4 col-6 my-2 text-center border">
                            <img src="{{ image.image.url }}" class="image-fluid rounded responds-img" alt="...">
                        </div>
                        {% endfor %}
                    </div>
                </div>
                    <div class="text-center">
                        <small><a href="#" data-bs-toggle="modal" data-bs-target="#deleteRespond">Отменить исполнителя</a></small>
                    </div>
                </div>
            </div>

        {% elif amount_responds >= order.max_responds %}
        <p>К сожалению, отклик к этому заданию больше нельзя оставить, так как превышено максимальное количество откликов.<br>
        Если потребуются дополнительные отклики, вам придет уведомление.</p>

        {% endif %}

    </div>
</body>
</html>